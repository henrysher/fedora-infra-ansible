# Automatically generated by ODCS.
# PRODUCT INFO
release_name = '{{ config.release_name }}'
release_short = '{{ config.release_short }}'
release_version = '{{ config.release_version }}'
release_is_layered = False

# GENERAL SETTINGS
bootable = {{ config.bootable }}

variants_file='variants.xml'

{%- if config.sigkeys %}
sigkeys = [
{%- for sigkey in config.sigkeys %}
        '{{ sigkey }}',
{%- endfor%}
]
{%- else %}
sigkeys = [None]
{%- endif %}

hashed_directories = True

# RUNROOT settings
{%- if config.bootable %}
runroot = True
{%- else %}
runroot = False
{%- endif %}


# PKGSET
{%- if config.pkgset_source == 'repos' %}
pkgset_source = 'repos'
pkgset_repos = {
{%- for arch in config.arches %}
    '{{ arch }}': ['{{ config.source }}',],
{%- endfor %}
}
{%- elif config.pkgset_source == 'koji' %}
pkgset_source = 'koji'

{%- if config.koji_tag %}
pkgset_koji_tag = '{{ config.koji_tag }}'
{%- else %}
pkgset_koji_tag = ""
{%- endif %}

{%- if config.koji_module_tags %}
pkgset_koji_module_tag = [
{%- for tag in config.koji_module_tags %}
    '{{ tag }}',
{%- endfor %}
]
{%- endif %}

{%- if config.module_defaults_url %}
module_defaults_dir = {
    "scm": "git",
    "repo": '{{ config.module_defaults_url[0] }}',
    "branch": '{{ config.module_defaults_url[1] }}',
    "dir": ".",
}
{%- endif %}

pkgset_koji_inherit = {{ config.pkgset_koji_inherit }}
pkgset_koji_builds = [
{%- for build in config.builds %}
    '{{ build }}',
{%- endfor %}
]
{%- endif %}

{%- if config.source_type_str in ["tag", "build"] and not config.packages %}
# In case no package is requested, include all of them.
additional_packages = [
    ('^Temporary$', {
        '*': [
            '*',
        ],
    }),
]
{%- endif %}

filter_system_release_packages = False

multilib = [
    ('^.*$', {
{%- for multilib_arch in config.multilib_arches %}
        '{{ multilib_arch }}': {{ config.multilib_method }}
{%- endfor%}
    }),
]

# GATHER
gather_source = '{{ config.gather_source }}'
gather_method = '{{ config.gather_method }}'
{%- if config.comps_file %}
comps_file = '{{ config.comps_file }}'
{%- endif %}
check_deps = {{ config.check_deps }}
greedy_method = 'build'

gather_lookaside_repos = [
    ('^.*$', {
        '*': [
{%- for lookaside_repo in config.lookaside_repos %}
            '{{ lookaside_repo }}',
{%- endfor %}
        ]
    }),
]


# CREATEREPO
createrepo_c = True
createrepo_checksum = 'sha256'

# CHECKSUMS
media_checksums = ['sha256']
create_jigdo = False

# BUILDINSTALL
{%- if config.bootable %}
buildinstall_method="lorax"
buildinstall_topdir="/mnt/koji/compose/odcs"
{%- endif %}

skip_phases = [
{%- if "iso" not in config.results %}
    "createiso",
{%- endif %}
{%- if "boot.iso" not in config.results %}
    "buildinstall",
{%- endif %}
    "live_media",
    "live_images",
    "ostree"]

link_type = 'symlink'

translate_paths = [
]

koji_profile = '{{ config.koji_profile }}'

dogpile_cache_backend = "dogpile.cache.dbm"
dogpile_cache_arguments = {
    "filename": "/var/tmp/pungi_cache_file.dbm",
}
dogpile_cache_expiration_time = 14400

repoclosure_strictness = [('.*', {'*': 'off'})]

{%- if config.include_devel_modules %}
include_devel_modules = { "Temporary": [
{%- for ns in config.include_devel_modules %}
        '{{ ns }}',
{%- endfor%}
]}
{%- endif %}

